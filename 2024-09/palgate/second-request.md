# second request

even with current version, even without proxy, you get:

~~~
POST https://api1.pal-es.com/v1/bt/un/verify/start/+12345678901?countryCode=us&os=android HTTP/2.0
content-type: application/json; charset=UTF-8
user-agent: okhttp/4.9.3

{
  "v": 1,
  "s": "cbcaffb0-2d70-4dab-bc99-b475cb5028f0",
  "b": "F883B121D238F41D930F281C7A742A1ED75ACD96079AB58B3961CA17B86E993C87B63DB3DE9C422542757DBA614FDE2B48942C437D41F4A45BD3699CED32885937736C65E77D6D242784B9BC69763750D36F6013B1F6EA37C18CCDBB037690322DDF3565B15CCC71177B8552341A741F21C31337D259FEAF22BE1060DE429A7A01EC29B8A4AFBA822E35016A615E2FB6A57DFD8C466AC208DFF08B179FAB200150980351C6C8883C11F992595B37005DD13560B2A49641A1D896BD3473C6706D89FCAB1803924DBD233C7157E35C252EA01E3DBEFB7473003E0FBE6E435C5E8FAD42B4AD3226E96C81FA7F12F568168FFA011402314C29B09EB196383F0C0CB85684E8A0A0F47143DC8497B31A0F34570AE87347145E511E7029859656FFD9A8D7950D6A912EC84C6F14A40CDFCF3076000DB01D134472124F1A7120070B1C9BF8F75B486F5A8291653B2124FCC5FA20779E44610FB9E85047B53B23A7FAD0026F06814A4309EA969F75015368D9927A174118190D9F5DADBB9CEE09798A413B7C8AB778079E274A0C1336B03102613D45F5A829FDC44FBE97A8485772F91C7675313922A6F31F9784DB30649064ED2E1DF0281414ACD13CE19B0D4FA5F1595264B5666D0DC588188C466A9439402312E2BD7F68A091D61DC5ECA407EED90B4C14979194146E76A8E8E4D43AE5D585470B2CDC8E78895F2CBCEB5E7B594C533370C7FE210E65C0091CD2708A71B4D89DA95FA6A343A2E452C8A9553C4E0D93964914009C1809645CBC058C9F2720C517C61C0C6AA7749DBA0992845AE64119AAE7BA0C667F75F5721DF04743330C40BB5C77267A7AD2704B0237A931060226AC78112666DAED0B214517F60EFA5122AADE67FABD5664B66A7EAF2561A3CFDE05AC652F2EF3EC8EB63CC35698E93C08412B5E8383695A6C56BEBF1513902863644456A32F9B51EE454199E3BD2580FA089F29EC6BEB39840DF0020F9230AC51633C5C1C4829FD449858A28D350600D725B3ACF09DB819A798DA288D69E21319598F1B60310374E8B7222D690E1F76F55A81DBECB6793C5CAEBB3079069CEEC3BC77F561A023F6F962EBB1A86A60AD46897DCF212C04962727D73A4C0E364C4B9A95F56199EC3DF2345FB8AE44351905BCE5ABA88ECF6D5F22E9F71153D67878301BA8573A5E660338DCE5DC93C1ACAF8EBDC1CFBFC54AE02960FCD886F8B4ED8F7C0AF405C405819F2E9C53A248DDA9A92F349B3A1F46AA68A22BDC6957C3E8188E629E959656D8930D313254D1B84255B63B9A3ADBC5354A023023804F826E9A08413D6F0F378B91DB3C579091BF01B068B15268907B55B832719C184F768D760B115427F6F40C4EAAD89488004D1516B021B23CCC6D2AA0D8FF710DDB5B6CBD4427CD5150A93C2FC808684DC5B80FB5180607862A22515DE39F4B9DEE0A4174FCB0A1A8899E340EC80B7F4ADB384B0B9A37844FC067A57AED75A260D19D143E5C2DD11F5D803BA7504F57B7A9BCDEA61B7E9F63C4BDF6079DEBCF7EBE2C6FBCEC442F5B6C4AC40D2929FF4633F074B2BEA65D0794E97A91D4FF68578557FF11BBA9C35D38AF4B104D7FC201F2C89F3247EBAD646865DE10AE35FB3511FC4F1337442AA471A209924746E358B3998C9558DB5F13EF67244F54B634B8B3E5A5591A6A270B5A8C116CC4B06B5A1FAF5746D9F4F55B775DC725E3CA3D7C6811C014DD638A96EF21CD23F75C408E2B011A02B6086B8367E0D2AF129880963B42AEA63BB734A89221FF8CBCD452900880EF6AF95DF8AA3C76EB6F1AE3D6550988E3B5B4F830291885974812959C3E395DA92E3D624091D76440709C1C175C7977A58174CF8140E54D607464F2316B0D6AF6503A2B94A52FE6086306BD884E733DDD24EEDD778B2CA08257F827DA8E1001943399D721856C04983EBAD1498042A6A0033BEAA402739D6D7356BACD3E37FF15A07D141B8BCA0229219C901A7CA7AC5B36A64D564DC2F1E68EC6C452A327E95C8B3610FC63B85AE0433A0A0B06DB73692C82DB171231A6E10EB9DAD969E730A151EE6841481DDA9512E95805A5281B5C9547AE730A5CD2F62B4A71571BCE094902CB995C2D81813C52C52FB9650526C2A2D5A9E71567526B85DBC91DB93328A3418BF440A7D64C8848520942859B434C797885E6923A64E1A41347F942B96651A6D7A74DB1D41B389A842C4A92A2D48A7E3FE9FD7A765EB00338B41165F0D9D245D7A4DF4D7C7AC38C6935589EC1C3DE7DF2B07EB80A24F36E7647EFB4631CF79A7F8A5F95B59FEE586580B954B6D6438E0A469F0FE41F3F0EDD2EC1888B4414951981C3B65242D46D968DCD89DC737917BC0D49707D5CC59A7F6817181475893C03E41EA48230BF948A43B01D7EC27BA66FA85813D6FA493258B35322020F817759BE1A13DE22D26A2D29B99562A56A40A981D395A4E53B316B583CAC86853F8D1F29A17A47D137519251BF5E8959733D1E3FD68DD303DA51905F13BCBE13BBA14DDF694A0AD3C4BE39F7980054AA81596EA9C8B3FB42DA26235B0E1F21CDEB2A7CC0EC1E0C93B55F859609A2B0BA20AD71613D98B08C0333863404ADFFAF058DDDB64168EA2ED958A2F957B6D858002EEEB2B92C0CF48B7408CE2E53028C714662A08E20A2EE54A6611B992C399383BC85E8A051EBE0E4A8FC834F32887DE85E9ED724AB03AE60853A67339140FE8DA0188999BBC23EA15841871072696950778A5E0A8E6642B741B864B53F340A04418BCDDC2D3450A4A3DFF27714F3043580E29B74A0C6738F2C60F61323A5A8F52A200F2A0344392948F508579AB593C2A4D9D487BECA082B45BEA6B8A4170FD7B8D3079C4E0272C1A205092C0CCC21487C65297CA0D403A37ABE88AF6801511F918B45A44C98E185A87700FE3C2FB3BF173E49D16A3CE21776018031B683CDA1522EC623BC1C1A7155C366B1633B86693156069565E79432AB1CFEBE73451F8EB1D4B5C214514BE232214A5967FD9AD924D2077DB0F6010B1055757C0CC3D9850725D0C5928C627017F6EC666E9B461C08EA59D56E62DC2D2D44D03269028ED12AEAC50D15279F247178EFA577B57F032A20B074A22DF64136799E2681375B5A92345C97B76873B5AC8DCB18353FD2257CC2A5A9239E002E1031F737056B9A62BF985EDB38E077BE38629A655DE2F297653A7F3E04618C00046431A50F4DEAF34F925ABFB8A287FB9BBB4B36906FBFA9085353545C8342D1A1259CCBA0E6DE8B0F9B90DC7262DFF476E760A45DA9F819228B386B733D6C027371C836193552871472FAEAB565651873AC3D8C4787256F84F71F1060D1DE99153432973DD04E273E04CDAF1F82377C0247260712706D8E4664F1C9520C8E52863C840724F5ED9CA764F48D484B5726113EC526136D3AE498EDB04A0CCF5383AA49DCCD1E4CAD7DA91988C1A9F824B1609BF379A02C92C310E63425AC83B20664EB091F7EC72CE211D6C6BD543CD2F103E5417303689FBB63DEFFFE17137D05764CD10C24B547B111FE75F39CF07B6D23BE290A591550B7AA31539AB57776EBB262D9F53ABDD6B13CB0FE5B597064F493AC38E5B6455C5C790881F40D4DC35D58983B5A19EDC4CC77232BE5006F5B9C985182AB11A278889BA7B43A515FA5FB00FE6DF9478AF7BB3DEEA7D70825428D91347221579689BCB05A27FF30D5878C13CBEBC26885CF648B9A7882BC8CC7B13D3CB46D27282F8F2A29229661C3CE17BACD1FDD748ABBBAA9850346318535B54B1C0D291ACA1D91B1C9D3CF908A8F2FAF0CD6F436CD82EA1E02EC473B968E522784F6FA17551E16988BA0E1A4E180157897A3F82A789ABE3FDC2FC8664435FD914BC54A10730D7845A5DBD62C3EF7C45BA210B519790875735C527DAFB6F9977C6A30480C7D84C05A40A4F676C36AD4213E84819A99B908B954DE84525FCBDE14B114A4B49CADB5A2FFE68F92A000693F2DAAD732ACFC9630E9ACD02F21F52F1003D48F32D30FCC33334052B844FDBB9FC5ADB88EBC986A700E2C2C725C6DE12F1883F68B779D23786AC1904813233E45B402D0536109268842B32E163165C7428608F4276088AC2C5516B0042975C4AC0899DDAA2F4034224C2E07BA3EBCC5068CE12A99FCA63520485F211FDFC88F3726EBFE71A0C3868B80465D5F40BDB8457DD40C37E1DC538F29F5F672C052A66BEE88045FD030AF3603500311DE865A156BE19F2EA939474BF96DA1AF9081E24678E5E42D32F8D75ED47B931F69B3BC11287416BDF103AD8B934DA5755A9E6B26F7BCAE0DC25C4A6DB997CD9DDF142CA39B95806BFA1F0CAFCB2AE43E88813FB7DFEED5AF4952CD15F3979C8022A4828475A7B68B7C4CF145CFF486028EFE0154FD0E765146FF037A04DFCA7D6D83F36F835C935B3309342B828DCB6C96969A2CC53375360FE9EC316887F02EAC8AA5AAFFEE3837C0740C41DB1C01435DE37E4378E908291453D8A637A4366AB8C58792239CD6AEB43DE30D4387B30938A45C693F31DD48113C3F893A41257113D5F53248FB2B6D1960E6B8EA4C008F8D733A2AB63CBD8DBD176D8A4BBF4E84C28E51413E831259B18D939A90F9BC42998D2E0396A19501BCBDF6B767E14E9278ADBE77361154B77A5E73B4F3DDF39E7E1477BF6E88346F9CDD536D21EA5415314A5DB8451FDEA09865852A6F328889477D4A3CB325DC6D9878F0452F5EFE3787D4D392EFCC2E00DD2E1DA14144F8AE8BF117272383F63B041EF9473287F926C9CA3873F4070D1F19C3F1BA3C8192B3229CA45833D74087586DFA92E8EEED2ADE9563906D514F47EC7C2AA71B14CE19B049DE2B4515FE5A2E1F9659C444D2683B146A7C44EFA15B2DE37003F0367EB81A1ACE7EF7EBF8AA1716323DF2D0C071A9E268A3CFA5618D7051D18C1E1D4B544346A71A983C393F2C1006B7B50D55253271C3334E8673304D5A892A79CA3448CB79011603F9C29E1D3ECF9C5B7A384A81AE02253C60C77F4A477286C2C3EE448BB8C901B34A33B6CA124A3A72515115FF1961690BA3AB29903CC5A4101A43043BDFF76BD2C51C0E4E33AF8C3459B9A481E72587855963B76AFED3338EDD6F8E6C3A4A8542C6110988841300B889ED6723FC0836A863EAB6C4DB8C8719D4664ACECE7E5A5973FF81F7C7C51F50272396C1FC8E812C025B2D74115547C2275A056496363FD703F626070DC7B613C3D32F772AD091A232300D2D07EBB2AA780B29E225782F3DB434A148257224EFF1FA95C960A0BF60D442A149FC82178B5510949DA2BE3547314C539C24AE368860A06BADF19365509D0649164545287C585E2285DBAD598F0251BC3F05D44DB5901C3BA68D67AB26B61A9C5493DA8437BBA2BAE63B38B02FA7E894DFAFCF7FA71CD9715B47F844BCE2089E304E703BD2639E9A5EC18E45318EC828225D980508D95A701BBB774A5925E94AF32D72588441BE58245C6B8E55CD5F5A7128BE7FF99B23240D728F5B45978F6552C5E5155EA24B84E4AE023C00B6BB77CAC0290B19DFE7B70907023D6307C45B43FFF7A3F4DAB68F49BA8A4E70A8229772F44A2D2CD8871F64C145B524FF1A69CACE5616C8A28831D7834B489376763E1250992ABC1721718E336C3228D9651A388C7318E7122EAC645115B137D1DE29A6A79260A8BDC830D1C4A4A2E4B7E3273FD820BD9DB3BA58EBC24318BB802438A50C702278AB8FA7C3EB1AAE6688038212C373AA2F8DA25C79D7214ED2118F8C23416519EDA1C38DDB2FE8A2FBF0070F2029FD4DBC0B65ADF3DA8F8C1B4619815CE37E0B",
  "type": "sms",
  "k": "EC7FF1016262879E2075220E428216F3"
}

HTTP/2.0 400 
date: Sun, 22 Sep 2024 14:59:35 GMT
content-type: application/json; charset=utf-8
content-length: 74
access-control-allow-origin: *
access-control-allow-methods: GET,PUT,POST,DELETE,OPTIONS
access-control-max-age: 600
strict-transport-security: max-age=15724800; includeSubDomains

{"status":"failed","msg":"Unable to register: Security check not passed!"}
~~~

lets download oldest working version:

~~~
play -i com.bluegate.app -c 342
~~~

extract:

~~~
jadx com.bluegate.app-342.apk
~~~

start here:

~~~
sources\com\bluegate\shared\BlueGateAPI.java
@o("un/verify/start/{id}")
e<OneTimeTokenResponse> sVerifyStart(@s("id") String str, @t("countryCode") String str2, @t("os") String str3, @a Map<String, Object> map);
~~~

then:

~~~
sources\com\bluegate\shared\ConnectionManager.java
public void sVerifyStart(String str, String str2, String str3, Map<String, Object> map, Response response) {
~~~

then:

~~~
sources\com\bluegate\app\fragments\VerifyPhoneFragment.java
395:ConnectionManager.getInstance().sVerifyStart(r3, VerifyPhoneFragment.this.mCountryCode, Constants.OS_ANDROID, hashMap, new AnonymousClass1());
1036:ConnectionManager.getInstance().sVerifyStart(r3, VerifyPhoneFragment.this.mCountryCode, Constants.OS_ANDROID, hashMap, new AnonymousClass1());
~~~

then:

~~~
hashMap.put("v", 1);
hashMap.put("type", r4);
hashMap.put("s", VerifyPhoneFragment.this.mSessionId);
hashMap.put("k", SharedUtils.intToHexString(t22));
if (FaceDetectNative.getInstance() != null && pk != null) {
   FaceDetectNative.getInstance().setPk(pk);
   FaceDetectNative.getInstance().setUser(r3);
   FaceDetectNative.getInstance().startBox();
   hashMap.put("b", FaceDetectNative.getInstance().getBox());
}
~~~

then:

~~~java
this.mSessionId = UUID.randomUUID().toString();
~~~

so `s` is good, what about `k`:

~~~java
int[] t22 = r2.getT2(hexStringToByteArray);
~~~

then:

~~~java
byte[] hexStringToByteArray = Utils.hexStringToByteArray(VerifyPhoneFragment.this.mT1_S);
~~~

then:

~~~java
VerifyPhoneFragment.this.mT1_S = oneTimeTokenResponse.getK();
~~~

then:

~~~
sources\com\bluegate\shared\FaceDetectNative.java
static {
   System.loadLibrary("native-lib");
}
public native int[] getT2(byte[] bArr);
~~~

which is here:

~~~
com.bluegate.app-config.x86-342.apk\lib\x86\libnative-lib.so
~~~

how do we call it?
